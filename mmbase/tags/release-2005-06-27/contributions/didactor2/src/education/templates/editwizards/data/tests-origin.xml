<?xml version="1.0"?>
<!DOCTYPE wizard-schema PUBLIC "-//MMBase/DTD editwizard 1.0//EN" "http://www.mmbase.org/dtd/wizard-schema_1_0.dtd">
<wizard-schema id="empty">
    <title>Toets Editor</title>

    <action type="create">
        <object type="tests">
          <relation destination="$origin" role="posrel" createdir="source"/>
          <field name="maychange">0</field>
          <field name="mayview">0</field>
          <field name="questionsperpage">0</field>
          <field name="feedbackpage">0</field>
        </object>
    </action>

    <action type="load">
        <relation destination="questions" role="posrel" />
        <relation destination="mmevents" role="related" />
        <relation destination="feedback" role="related" />
        <relation destination="competencies" role="needcomp" />
        <relation destination="competencies" role="developcomp" />
    </action>

    <action type="delete" />

  <lists>
       <optionlist include="paragraphs/boolean.xml" />
      <optionlist name="maychange">
          <option id="0">Nee</option>
          <option id="1">Ja</option>
      </optionlist>
      <optionlist name="mayview">
          <option id="0">Nee</option>
          <option id="1">Ja</option>
      </optionlist>
      <optionlist name="questionsperpage">
          <option id="0">Alle vragen op 1 pagina</option>
          <option id="1">1 vraag per pagina</option>
      </optionlist>
      <optionlist name="feedbackpage">
          <option id="0">geslaagd/gezakt</option>
          <option id="1">overzicht van antwoorden</option>
      </optionlist>
  </lists>

    <steps>
        <step form-schema="step1" />
        <step form-schema="step2" />
    </steps>

    <form-schema id="step1">
        <title>Toets invoeren</title>

        <field name="name" >
            <prompt>Naam</prompt>
        </field>

      <field name="showtitle" ftype="enum">
         <prompt xml:lang="nl">Titel laten zien</prompt>
         <prompt xml:lang="en">Show title</prompt>
         <optionlist select="boolean"></optionlist>
      </field>
 

        <field name="text" ftype="html" dtminlength="0">
            <prompt>Tekst</prompt>
        </field>

   <field name="questionamount">
            <prompt>Aantal te stellen vragen (&lt; 1: alle)</prompt>
        </field>

        <field name="requiredscore">
            <prompt>Benodigd aantal goed</prompt>
        </field>

      <field name="maychange" ftype="enum">
          <prompt>Mag de student deze toets opnieuw maken?</prompt>
          <optionlist select="maychange" />
      </field>

      <field name="mayview" ftype="enum">
          <prompt>Mag de student deze toets bekijken na het maken?</prompt>
          <optionlist select="mayview" />
      </field>

      <field name="questionsperpage" ftype="enum">
          <prompt>Aantal vragen per pagina</prompt>
          <optionlist select="questionsperpage" />
      </field>

      <field name="feedbackpage" ftype="enum">
          <prompt>Feedback na het maken van de vraag</prompt>
          <optionlist select="feedbackpage" />
      </field>

        <list minoccurs="0" maxoccurs="*" ordertype="number" orderby="field[@name='pos']" role="posrel" destination="questions">
            <title>Bijbehorende vragen</title>
            <item>
                <field name="title" ftype="data">
                    <prompt>Titel</prompt>
                    <description>Titel van de vraag</description>
                </field>
                <field fdatapath="field[@name=&apos;pos&apos;]" ftype="line"><prompt>Positie</prompt></field>
            </item>

            <action type="create">
                <relation role="posrel" destinationtype="questions">
                    <field name="pos">{sum(//relation[@role='posrel' and @lastitem='true']/field[@name='pos'])+{$pos}}</field>
                </relation>
            </action>

            <command name="search" nodepath="questions" fields="title" age="-1" orderby="number" directions="down" >
                <prompt>Zoeken naar vragen</prompt>
                <search-filter>
                    <name>Titel bevat</name>
                    <search-fields>title</search-fields>
                </search-filter>
            </command>

            <command name="startwizard" inline="true" wizardname="mcquestions" objectnumber="new">
                <prompt>Nieuwe Multiple Choice vraag</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="openquestions" objectnumber="new">
                <prompt>Nieuwe Open vraag</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="rankingquestions" objectnumber="new">
                <prompt>Nieuwe Rangorde vraag</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="valuequestions" objectnumber="new">
                <prompt>Nieuwe Waarde vraag</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="couplingquestions" objectnumber="new">
                <prompt>Nieuwe Koppel vraag</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="hotspotquestions" objectnumber="new">
                <prompt>Nieuwe Hotspot vraag</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="dropquestions" objectnumber="new">
                <prompt>Nieuwe drag en drop vraag</prompt>
            </command>


<!-- Not available in this version. Take care that the reuse questions is based on another question.
            <command name="startwizard" inline="true" wizardname="reusequestions" objectnumber="new">
                <prompt>Nieuwe Hergebruik vraag</prompt>
            </command>
-->
        </list>

        <!-- we need a new list to make an extra search command -->
        <list minoccurs="0" maxoccurs="*" ordertype="number" orderby="field[@name='pos']" role="posrel" destination="questions">
            <title>Zoeken op metadata</title>
            <item displaytype="none"></item>

            <action type="create">
                <relation role="posrel" destinationtype="questions">
                  <field name="pos">{sum(//relation[@role='posrel' and @lastitem='true']/field[@name='pos'])+{$pos}}</field>
                </relation>
            </action>


             <command name="search" nodepath="metadata,questions" fields="questions.title,metadata.value" age="-1" orderby="questions.number" directions="down" >
                <prompt>Zoeken naar vragen op metadata</prompt>
                <search-filter>
                    <name>Metadata bevat</name>
                    <search-fields>metadata.value</search-fields>
                </search-filter>
           </command>
        </list>


        <list role="related" extends="list/online.xml" />
        <list destination="feedback" role="related" extends="list/feedback.xml" />
    </form-schema>

    <form-schema id="step2">
        <title>Competenties invoeren</title>
        <field name="name" ftype="data"/>
        <list extends="list/needcompetencies.xml"/>
        <list extends="list/developcompetencies.xml"/>
    </form-schema>
</wizard-schema>
