===================================================================
                     MMBase 1.9.2 - Release Notes
===================================================================

============
INTRODUCTION:
============

This document describes the changes that have been made in the final
release of MMBase 1.9.0, relative to the previous release of MMBase (1.8.x).

Bug reports should be entered at the bug reporting system for MMBase
at:

<http://www.mmbase.org/bug>


Release notes generated by JIRA:
http://www.mmbase.org/jira/secure/ReleaseNote.jspa?projectId=10000&styleName=Html&version=10170


NOTE for MySQL users upgrading from a version < 1.9.2.
-----------------------------------------------------
Case sensitive searching has been fixed:

http://www.mmbase.org/jira/browse/MMB-1835

and associated performance problems too:

http://www.mmbase.org/jira/browse/MMB-1841

Fields can now explicitly be marked as 'case sensitive'.
      <datatype base="line" xmlns="http://www.mmbase.org/xmlns/datatypes" >
        <property name="collator" value=":IDENTICAL" />
        <required value="true" enforce="never" />
        <maxLength value="255" />
      </datatype>
The database tables must be altered too for those fields.
e.g.:
alter table oi_icaches_table change ckey ckey varchar(255) collate utf8_bin not null;

If you fail to do this, performance may suffer, because the index cannot be used.

Also, when using <mm:constraint> the following property can be used to change the case-setting:
'casesensitive="true"' to set it case sensitive. This speeds up MySQL searching.


org.mmbase.util.functions.NodeFunction#getCoreNode  was dropped. If you used it, now extend from
org.mmbase.module.core/MMObjectNodeFunction. (MMB-1896)



============
NEW FEATURES:
============

--------------------
General New Features:
--------------------
[1.9.1]
    * [MMB-1732] - select in select queries
    * [MMB-1734] - Javascript code to 'mold' straightforward html produced by mm:fieldinfo to more sophisticated input widgets.
    * [MMB-1736] - Datatype to support money, valute, currency.
    * [MMB-1739] - A way to influence which of the resources is loaded, if it is present in multiple jars.
    * [MMB-1748] - 'absolute' attribute on mm:image, mm:attachment, like on mm:link.
    * [MMB-1749] - Possibility to use different builder to store users in.
    * [MMB-1750] - disposition attribute on mm:image
    * [MMB-1764] - MMBase query containers could recognized the more generic interface 'SearchQuery'.
    * [MMB-1767] - Create disableContextChecks property in Contexts builder of CloudContext Security
    * [MMB-1771] - Added a new CSVReader as a replacement for the deprecated CVSReader
    * [MMB-1775] - new option to add properties to nodes when properties builder is present
    * [MMB-1776] - Added nodelist function to the properties builder
    * [MMB-1782] - DatabaseTransaction linked to the current thread.
    * [MMB-1792] - Woud be handy to be able to produce a constraint by a function and add it to a query.
    * [MMB-1794] - New enforce-strength which are only used during explicit validation.
    * [MMB-1797] - Make it optionally required to link servers to cronjob objects.
    * [MMB-1802] - mysql_with_views
    * [MMB-1803] - Support for H2 database.
    * [MMB-1805] - A way to easily modify DataType objects on the fly.
    * [MMB-1807] - Append style classes to DataType
    * [MMB-1811] - Various new logging utils.
    * [MMB-1813] - If you have a transaction you cannot obtain the original Cloud back.
    * [MMB-1815] - DataType#getDeleteProcessor.
    * [MMB-1818] - BridgeList lacks getProperties.
    * [MMB-1822] - Node#setNodeManager(NodeManager).

    * [MMB-1036] - support for the REGEXP field constraints
    * [MMB-1560] - Typehandlers of taglib are related to datatypes.
    * [MMB-1737] - lastmodified, lastmodifier always set themselved on commit of node, even if no other fields were changed.
    * [MMB-1745] - support larger binaries than 16m in mysql
    * [MMB-1757] - cloud context security implementation is not very extensible.
    * [MMB-1778] - jdbc.xml should not be in the mmbase.jar
    * [MMB-1779] - BasicQueryHandler does its own Connection management.
    * [MMB-1783] - Default logging implementation does not quite work as expected.
    * [MMB-1789] - my_editors: more enters disappear
    * [MMB-1806] - Improve io stream copy performance
    * [MMB-1810] - Several issues with binaries.
    * [MMB-1821] - Using the 'current' node in enumeration restrictions


[1.9.0]

- On a lot of places java 1.5 features were used in the implementation of core and applications.
  (like generics, varargs, StringBuilder).

- start on org.mmbase.framework

- command server for image magick (to avoid memory doubling)


  * [MMB-273] - There are a lot of dependencies on xerces/xalan
    * [MMB-356] - Only one alias per node in application export.
    * [MMB-1107] - mmbase should support mbeans and jmx
    * [MMB-1121] - Could maximum length of owner name be extended beyond 12 chars ?
    * [MMB-1205] - A way to quickly select a node.
    * [MMB-1217] - mm:isrelated
    * [MMB-1253] - Missing a way to remove markup.
    * [MMB-1473] - Hits/misses of caches are stored in a int, which may be too small.
    * [MMB-1573] - Alphabetic ordering of nodetypes in generic pulldowns
    * [MMB-1650] - Cascading css classes of components are way to specific
    * [MMB-1388] - standard css class names for classes for icons and content images
    * [MMB-1389] - functionality to escape specific blocks
    * [MMB-1410] - Implement security <mm:may action=".."/> and <mm:setting name=".." />
    * [MMB-1411] - Finish processor
    * [MMB-1422] - Admin interface for the default component framework
    * [MMB-1498] - ConnectionFramework, ConnectionRenderer
    * [MMB-1543] - ThreadGroup in logfiles.
    * [MMB-1554] - Support for longblob, longtext in mysql.
    * [MMB-1580] - MMCF based admin pages must be functional
    * [MMB-1581] - Weighted block classifications
    * [MMB-1582] - Settings persistence implementation
    * [MMB-1631] - Datatype properties to be not only String.
    * [MMB-1668] - It would be nice if it would be possible to set constraints in dynamic include, tag-fragments etc.
    * [MMB-1690] - Keyword functionality.
    * [MMB-1693] - level attribute on mm:log
    * [MMB-1698] - Should be able to use 'blocks' in editwizard definitions too.
    * [MMB-1714] - It must be possible to replace builders while 'extending' them.
    * [MMB-1715] - Support for 'Content-Disposition' builder property.
    * [MMB-1720] - Decent object type to contain flash objects.
    * [MMB-1728] - Property-matching with class-security.
    * [MMB-1729] - Programmatic deployments of apps
    * [MMB-1402] - MMCI bridge interfaces and java 1.5 generics.
    * [MMB-1409] - MMBase does not compile against java 1.6
    * [MMB-1413] - write test-cases on redirect and url generation (can be used to check and test implemented functionality)
    * [MMB-1445] - mmbase-module files are full of empty directories.
    * [MMB-1474] - Build/install process of a component
    * [MMB-1475] - Nightly build does not contain generated documentation any more.
    * [MMB-1486] - There is little point in implementing our own LRUHashtable, as java 1.4 provides one.
    * [MMB-1489] - rmmci must be fixed again.
    * [MMB-1521] - Decide what to do with org.mmbase.model
    * [MMB-1604] - Migrate CMSc guestbook portlet into MMCF guestbook component
    * [MMB-1649] - Drop Codings application and move its jsps and data to MyNews
    * [MMB-1656] - MMObjectNode supports 'properties', but the needed builder is missing. The functionality is undocumented as wel,.


Taglib New Features:
-------------------

- varStatus attribute on list-tags (like c:forEach)
- jspvar of writers can have any value.


------------------
Bug Fixes:
------------------
[1.9.1]
    * [MMB-468] - Indicating owner of typedef nodes in a 'typedef.xml' does not work
    * [MMB-1022] - Custom parameters are not passed to subwizards
    * [MMB-1113] - href is not used when editing a link + solution
    * [MMB-1189] - list.jsp: search by "number is" give strange effect with non-numeric values.
    * [MMB-1215] - Required htmlarea's don't set properly.
    * [MMB-1256] - constraints don't work on datetimes
    * [MMB-1283] - guitype boolean on a string-field does not work any more.
    * [MMB-1312] - Extending builders with binary fields. The blob fields are not mirrored in extension's table.
    * [MMB-1334] - richtext editor does not work with html datatype
    * [MMB-1358] - mysql uses \ as escape sequence.
    * [MMB-1418] - Chained Commitor created when not needed
    * [MMB-1451] - mm:constraint handles referid attribute values with as builder step
    * [MMB-1458] - filename in URL may contain invalid chars.
    * [MMB-1556] - Using mm:import in list in list, created var is not EL compliant.
    * [MMB-1735] - mm:fieldlist or mm:useinput sometime prints a fields value
    * [MMB-1738] - If you call a few thousand times <mm:list orderby=".." path="..,..," then you get StackOverflowExceptions.
    * [MMB-1740] - If datatypes overrides one in a jar, that that does not always work, if the one in the jar is loaded before the ones in mmbase jar.
    * [MMB-1741] - Error from mysql (utf8) during deployment of systemproperties.
    * [MMB-1742] - mm:listrelationscontainer misses some attributes.
    * [MMB-1744] - Dates in pulldowns don't get saved when changed
    * [MMB-1746] - DAtabaseStorageManager.isNull should use checkStoreFieldAsFile(()
    * [MMB-1752] - change context rights not checked.
    * [MMB-1754] - Many ClassCastExceptions if running on jdk 1.7.
    * [MMB-1755] - Add always the searchtype attribute when objects are created/loaded
    * [MMB-1760] - Reused mm:context not EL compatible
    * [MMB-1765] - LocaleTag does not revert the jstl locale situation.
    * [MMB-1766] - Attribute value "bla bla" is quoted with " which must be escaped when used within the value
    * [MMB-1768] - clone of BasicSearchQuery not correct while copying the constraint.
    * [MMB-1769] - Processor has parameters, renderers have 'pattern' parameters. Exceptions occur. More generally process-urls are not correctly produced.
    * [MMB-1772] - backwards compatiblity issue: implicit 'cloning' of queries didn't work any more.
    * [MMB-1773] - 'time' field presented as datetime.
    * [MMB-1774] - duration datatype not working properly in editwizards
    * [MMB-1777] - getPage methods on UrlTag are called earlier then in 1.8. This is a backwards compatibility issue.
    * [MMB-1780] - If you don't use the JDBC module, then also the 'query logging' feature does not work any more.
    * [MMB-1781] - If you start mmbase when the database is down, it will not come up any more if the database is brought up.
    * [MMB-1784] - Media application does not use ResourceLoader
    * [MMB-1791] - It seems impossible to save an empty field
    * [MMB-1795] - The 'html' datatype does not make much sense.
    * [MMB-1808] - Uploading a blob may causes it to be converted to a byte array in memory.
    * [MMB-1809] - An inactive builder in config/builders doe not prevent it from being loaded
    * [MMB-1814] - Many lists not working via RMMCI
    * [MMB-1816] - cloud.getCloudContext().getUri() does not return the orignal URI use to obtain the Remote Cloud Context.
    * [MMB-1817] - ${_} in body of mm:import does not work as expected
    * [MMB-1819] - mm:relatednode on a referid'd listrelations give NPE
    * [MMB-1823] - mm:fieldinfo type="forid" refers to name, not id of <input>
    * [MMB-1824] - Order of parameters is different than in 1.8.
    * [MMB-1825] - System field Owner is always enforced at validation, because it is required.

[1.9.0]
   * [MMB-110] - Not all dtd known by xmlentityresolver
    * [MMB-182] - documetation fails when www.oasis-open.org not online
    * [MMB-333] - toString of BasicNode is empty if clusternode.
    * [MMB-348] - When typerel is changed, multilevel cache is not refreshed
    * [MMB-370] - Threads in MMBase use deprecated stop/suspend methods
    * [MMB-410] - hsql, if no size given in builder xml string field, create table fails.
    * [MMB-495] - ImageMagick creates empty images on failure
    * [MMB-570] - Community messages max body size is 2024 bytes
    * [MMB-583] - Community startup very slow (make community module deprecated?)
    * [MMB-803] - It is possible to insert images with empty handle and itype and then icache hangs
    * [MMB-811] - Some unclear module configuration files
    * [MMB-892] - my_editors en mmeditors don't use 1.7 searchquery and trherefore are causing inefficient queries.
    * [MMB-917] - Empty or emptied HTML-area generates a <br /> in Mozilla et al. and a </p> in MSIE
    * [MMB-922] - mm:include does not consider <?xml encoding="" header of included XML.
    * [MMB-967] - version numbers of application must be integer numbers
    * [MMB-994] -  <item displaymode="summarize" displaytype="image" /> does not work any more. (So with no fields)
    * [MMB-1028] - Immediately fetching blob after creating node can result in errors.
    * [MMB-1079] - If field null in resultset, NPE can occur, which fails the complete list.
    * [MMB-1138] - Insert web link bugged, removing the http:// results in strange effects.
    * [MMB-1208] - Using non-existing 'function' on cluster node gives enigmatic error:
    * [MMB-1223] - Using mm:form, XML fields behave enigmatic.
    * [MMB-1265] - CloudContext, LocalContext, RemoteContext, BasicCloudContext, it is a mess.
    * [MMB-1272] - Case sensitivity MySQL tablenames depending on platform -> use only lowercase for all tablenames, to prevent possible issues (esp.
    * [MMB-1276] - rights context cache already contained this entry waring
    * [MMB-1277] - SimpleDateFormat is not thread-safe.
    * [MMB-1286] - Can't create relations with a node that was found using its alias
    * [MMB-1287] - Pager doesn't seem to know about creating relations
    * [MMB-1289] - Legend missing
    * [MMB-1310] - images in links dont' work well.
    * [MMB-1315] - Cloud context security editors allow contexts > 12 characters
    * [MMB-1317] - Editwizards don't  seem to understand 'null' values.
    * [MMB-1323] - If icache node not in node cache any more after the conversion, then the image-server will server no bytes.
    * [MMB-1344] - ImageMagick and text, it is broken again. Now because it produces @<temporary file that was used>
    * [MMB-1345] - MMServers only considers 'machinename', not host, if host overriden with -Dmmbaseroot.host, that has no effect on the default machinename
    * [MMB-1347] - mm:countrelations role=""
    * [MMB-1350] - Images don't work if mapped to /img.db?
    * [MMB-1356] - In transaction you can create a node, even if you have no rights.
    * [MMB-1375] - ONLY optimization of Postgresql Query handler sometimes adds only when that is not justified.
    * [MMB-1376] - mm:createalias does not work directly in mm:createnode.
    * [MMB-1377] - org.mmbase.bridge.util.xml.query.QueryReader does not support postfixes digits on path elements.
    * [MMB-1379] - install task of email application does not copy mail.jar into the webapp
    * [MMB-1381] - s( ..<) and s(..>) features are not working when using JAI.
    * [MMB-1382] - IE memory leak in editwizards
    * [MMB-1385] - Fullback and import requires loads of memory to import binaries
    * [MMB-1386] - If you don't change 'blob' field, but other fields, it seems that the blob is still needed.
    * [MMB-1387] - the functionset_1_0.dtd does not allow the attribute 'required' on element 'param', but functionset.java does.
    * [MMB-1392] - crontab: equals of cronentry n ot complete, cannot change only configuration.
    * [MMB-1393] - mm:constraint field="number" value="<nodenumber>" operator="GREATER" does not work properly if node with number <nodenumber> does not exist.
    * [MMB-1396] - RMMCI doesn't compile.
    * [MMB-1399] - Build forgets to include mmbase/kupu/mmbase/index.jspx
    * [MMB-1406] - Data dir to contain README.txt
    * [MMB-1416] - Validation not limited to changed fields
    * [MMB-1424] - Some nodelists (still) give classcast exceptionss
    * [MMB-1448] - Excessive code duplication in wizard xsl.
    * [MMB-1452] - Node with XML-field is committed even if no fields are changed.
    * [MMB-1464] - lastmodifier field of the news application is not working with hsqldb
    * [MMB-1465] - oscache dependency on commons-logging is not forfilled
    * [MMB-1476] - mmbase-SNAPSHOT.mmbase-module is a bit of a mess.
    * [MMB-1490] - XMLEntityResolver.getMMEntities opens db-connections which are never closed
    * [MMB-1504] - Required fields don't work with old definition
    * [MMB-1514] - ${mm:escape} does not recognized mm:escaper-defined escapers.
    * [MMB-1540] - Cloud tag throws exception when authentication is off and the method attribute is set
    * [MMB-1547] - field ftype="startwizard"  throws exception when when the node is no yet saved
    * [MMB-1606] - mmbase-1.9.0.jar of maven is not compatible with original mmbase.jar of ant.
    * [MMB-1613] - Can not create new nodes with read only fields like created
    * [MMB-1614] - HSQL creates data directory gets outside of webapp
    * [MMB-1617] - compare tag: when referid points to a boolean and value is 'true' or 'false' you get a numberformatexception
    * [MMB-1638] - Maxuploadsize is only an int.
    * [MMB-1641] - MMBaseFilter captures too  much
    * [MMB-1644] - index.jsp of distro must be reviewed, fixed.
    * [MMB-1672] - ant build.xml broken.
    * [MMB-1676] - Daymarkers are created on start of day in UT, so timezones are ignored.
    * [MMB-1678] - Animated gifs are corrupted easily when scaled with ImageMagick
    * [MMB-1680] - Deleting nodes in transaction, gives horrible exception.
    * [MMB-1682] - Step#getNodes should return <code>null</code> according to javadoc if no nodes added. But it doesn't.
    * [MMB-1683] - Query#addNode(Step, integer) not accessible via taglib.
    * [MMB-1686] - RelatedCache of relation builders are registered in cache manager with the same name
    * [MMB-1695] - Missing links in documentation overview.
    * [MMB-1697] - Maven example webapp's config directory is to empty
    * [MMB-1700] - Float types should support Locale
    * [MMB-1703] - Email 'expires' queries only work with LONG fields
    * [MMB-1704] - BCC is sent as CC
    * [MMB-1705] - If using field="" attribute, of field referrer like mm:fieldinfo and the tag also uses the _node_ it may not use the node associated with the referred field provider.
    * [MMB-1723] - Cloudcontext Security application does not deploy correctly


---------------------------------------------------------
Known API incompatibilities of bridge, between 1.8 to 1.9.
---------------------------------------------------------

- Bridge. A RelationList is no NodeList any more (though a Relation is still a Node).

- Taglib. <mm:url generates object of type org.mmbase.bridge.jsp.taglib.pageflow.Url (rather then
  String).

- org.mmbase.storage.search.implementation.*. StringBuilders are used in API.

- org.mmbase.util was cleaned up a bit.
  e.g.
  org.mmbase.util.xml.ApplicationReader ->   org.mmbase.util.xml.applicationdata.ApplicationReader
  and similar changes


========================
Known Issues and Problems:
========================

- Imagemagick does work with Windows 98/ME, but MMBase is not able to
  use it. You have to use Jai (Java Advanced Imaging API). You can do
  this by changing the properties in

   <mmbase-webapp>/WEB-INF/config/builders/applications/images.xml (after installation of 'Resource')
   or
   <mmbase-webapp>/WEB-INF/config/applications/Resources/builders/images.xml (before installation of 'Resource')

   into:

  <properties>
    <property name="ImageConvertClass">
      org.mmbase.module.builders.ConvertJAI
    </property>
    <property name="MaxConcurrentRequests">20</property>
  </properties>

  Please keep in mind that the image builder is less powerful when
  using JAI instead of Imagemagick.

- Jumpers jump to /index.html by default, which can e.g. shield the
  image servlet (if 'dotlessly' mapped). Remove the setting from
  jumpers.xml if you prefer nice 404's (this is like this on default)

- Resin provides its own XSL-transformation implementation, on this
  area are some known problems.

- Resin cannot swallow some of the larger jsp/taglib pages.


============
Requirements:
============

MMBase versions need the following implementation versions of the servlet specification
(http://java.sun.com/products/servlet/) and Java. The shipped templates need implementations of the jsp specification
(http://java.sun.com/products/jsp/) and JSTL (http://java.sun.com/products/jsp/jstl/).

A complete J2EE implementation is not necessary.

Tomcat is an example servlet/jsp implementation, which many people use.


MMBase   Java   Servlet   JSP     JSTL   Tomcat  Orion
-----------------------------------------------------
1.8      1.4     2.3      1.2     1.1     4      2
1.9      5       2.4      2.0     1.1     5
2.0?     6       2.5      2.1     1.2     6


Furthermore MMBase needs a database and a jdbc-driver, or alternatively, a datasource resource
provided by the container.

The 'example webapp' includes an hsqldb database configuration and driver.


=========
Tested on:
=========

The applications listed here are known to be tested with MMBase, but
the list is probably a lot bigger :-)

See also /version?server

-------------
Java versions
-------------

- J2SE 1.5

-------------
Java compilers
-------------

- Sun's javac 1.5

  When altering line 115 in org.mmbase.cache.CacheManager from
    Cache cache = getCache(cacheName);
  to
    Cache<?,?> cache = getCache(cacheName);
  the compiler will run into a bug in Sun's javac regarding the casting of
  generic types. See: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4916620

------------------
Servlet engines /
Application servers
------------------

These are the applications servers on which MMBase was tested.

- Tomcat 5.5.17, 5.5.20, 6.0
- ..

---------
Databases
---------

- Mysql
- Hsqldb 1.8.0 (shipped with distro)
- Postgresql
- PostgreSQL 8.1.3



