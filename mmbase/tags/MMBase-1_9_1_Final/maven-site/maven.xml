<?xml version="1.0" encoding="UTF-8"?>
<!-- 
This software is OSI Certified Open Source Software.
OSI Certified is a certification mark of the Open Source Initiative.

The license (Mozilla version 1.0) can be read at the MMBase site.
See http://www.MMBase.org/license
-->
<project xmlns:j="jelly:core" xmlns:maven="jelly:maven" 
		xmlns:ant="jelly:ant" xmlns:artifact="artifact"
        xmlns:util="jelly:util"
        xmlns:velocity="jelly:velocity">

  <!--==================================================================-->
  <!-- Generate Overview of all projects                                -->
  <!--==================================================================-->    
  <preGoal name="multiproject:create-overview-page">
	<maven:get var="maven.multiproject.plugin.resources"
            plugin="maven-multiproject-plugin"
            property="plugin.resources"/>
        <move tofile="${maven.multiproject.plugin.resources}/templates/projects-overview.jelly.original" 
        	file="${maven.multiproject.plugin.resources}/templates/projects-overview.jelly"/>
        <copy todir="${maven.multiproject.plugin.resources}/templates" 
        	file="${maven.multiproject.templates}/projects-overview.jelly"/>
  </preGoal>
  
  <postGoal name="multiproject:create-overview-page">
	<maven:get var="maven.multiproject.plugin.resources"
            plugin="maven-multiproject-plugin"
            property="plugin.resources"/>
            
        <delete file="${maven.multiproject.plugin.resources}/templates/projects-overview.jelly"/>
        <move file="${maven.multiproject.plugin.resources}/templates/projects-overview.jelly.original" 
        	tofile="${maven.multiproject.plugin.resources}/templates/projects-overview.jelly"/>
  </postGoal>
  
  <postGoal name="site">
    <ant:copy todir="${maven.docs.dest}/documentation" preservelastmodified="true">
      <ant:mapper type="regexp" from="mmbase-(.*)docbook(.*)" to="\2" />
      <ant:fileset dir="${maven.docs.dest}/multiproject/">
        <include name="**/docbook/**"/>
      </ant:fileset>
    </ant:copy>
    
    <ant:copy todir="${maven.docs.dest}/documentation" preservelastmodified="true">
      <ant:mapper type="regexp" from="docbook(.*)" to="\1" />
      <ant:fileset dir="${maven.docs.dest}/multiproject/mmbase">
        <include name="docbook/**"/>
      </ant:fileset>
    </ant:copy>
  </postGoal>
  
</project>