<html>
<head><title>XML Importer installation guide</title></head>
<body>
Authors: Rob van Maris (Finalist IT Group), Erik Visser (Finalist IT Group)
<br>
Last revision: Januari 18th, 2002

<h4>Documentation</h4>
In order to understand the XML importer, it is recommended to read the following documents, available on the <a href="http://www.mmbase.org">MMBase website</a>:
<ol>
<li>TCP 1.0 documentation (see Temporary Cloud Project).
<li>XML Importer overview (see XML Importer Project/XML Importer).
<li>The javadoc documentation of the <code>org.mmbase.applications.xmlimporter</code> package.
</ol>


<h4>How to install XML Importer</h4>

The XML Importer has been tested with the recent CVS versions of MMBase. If you downloaded the MMDistro you have to update some files from cvs and copy them to your source directory. In our case these were:
<ul>
<li>org.mmbase.module.INFO.java
<li>org.mmbase.module.builders.MediaParts.java
<li>org.mmbase.module.PlaylistInterface.java
<li>org.mmbase.module.core.MMBaseContext.java
<li>org.mmbase.module.core.MMObjectBuilder.java
<li>org.mmbase.module.core.MMObjectNode.java
<li>org.mmbase.module.core.TemporaryNodeManager.java
<li>org.mmbase.module.core.TemporaryNodeManagerInterface.java
<li>org.mmbase.module.core.TransactionManager.java
<li>org.mmbase.module.core.TransactionManagerException.java
<li>org.mmbase.module.core.TransactionManagerInterface.java
<li>org.mmbase.module.core.TransactionResolver.java
<li>org.mmbase.module.corebuilders.FieldDefs.java
<li>org.mmbase.module.database.support.MMSQL92Node.java
<li>org.mmbase.module.gui.html.PageProcess.java
<li>org.mmbase.module.gui.html.scanparser.java
<li>org.mmbase.servlet.servdb.java
<li>org.mmbase.servlet.servscan.java
<li>org.mmbase.util.media.MediaUtils.java
<li>org.mmbase.util.scanpage.java
</ul>
Since MMBase is improved all the time this list will grow with time. If compilation errors occur a cvs update might solve the problem.

Next:
<ol>
<li>Download and unzip xmlimporter.zip from the XML-importer homepage on the MMBase website.
<li>Update the contents of mmbase/applications/xmlimporter from cvs.
<li>Update the contents of html/mmapps/xmlimporter from cvs.
<li>Update the file config/default/dtd/transactions.dtd from cvs.
<li>Edit transactionhandler.xml in your MMBase modules config directory, so that its status is set to "active" and its classfile to "org.mmbase.applications.xmlimporter.TransactionHandler".
<li>Copy upload.jar from /lib to your MMBase lib directory (usually Web-Inf/lib in your web-app). It is solely used for the file upload by the XML importer user interface JSP.
<li>In your MMBase config directory, create directories "import" and "import/report".
<li>Recompile/rebuild and redeploy your MMBase binaries.
</ol>
The next time MMBase is started, XML Importer will be installed and fully functional. It is recommended to install the examples next.

<h4>How to install the examples</h4>
The examples come in two parts: JUnit tests that test the XML Importer functionality, and XML importer examples that demonstrate the JSP user interface.
<p>In order to run the examples:
<ol>
<li>Copy the contents of /demo/src to your source directory (the packages org.mmbase.applications.xmlimporter.demo and org.mmbase.applications.xmlimporter.junit.
<li>Copy the contents of /demo/config to your MMBase config directory (this configures the builders "personsxxx" and "moviesxxx" - the "xxx" suffix is to prevent name clashes with existing builders -  and the junittester module).
<li>Copy the junit.jar from /demo/lib to your MMBase lib directory - it is used for the JUnit tests. If it is there already, it may be an old version, you need junit3.7.
<li>Recompile/rebuild and redeploy your MMBase binaries.
<li>Restart MMBase. Go to the typerel (RelationType) editor to create a new relationtype: source=moviesxxx, target=personsxxx, relation=related, maxRelations=-1. This definition will be used by the examples.
</ol>

<h4>How to run the examples</h4>
It is recommended to execute the JUnit tests as the first step, to see if everything works as expected.
<ol>
<li>Configure log4j to see the results of the JUnit tests, by setting the priority for the category <code>org.mmbase.applications.xmlimporter.junit.TestRunner</code> to "service".
<li>Restart MMBase. The junittester module is configured to execute two testsuites when MMBase is initialized: TmpObjectTest, TransactionHanlderTest and SpecificObjectFinderTest.
<li>Look in the log4j logfile to see the result of the tests. If all went well, the TestRunner reports having finished both testsuites with result OK. If you see the lines
<code>OK (6 tests)</code>, <code>OK (5 tests)</code> and <code>OK (1 tests)</code> XML Importer is running as expected (in spite of some warnings you may get), otherwise something is wrong.
</ol>
If the TestRunner reports errors or failures, set logging priority to "trace" for the category <code>org.mmbase.applications.xmlimporter</code> and restart MMBase to get a more detailed report to see what went wrong. Don't proceed until the problem is fixed and all tests are successfull.
<p>If you don't need the junittester anymore, set its status to "inactive" in its configuration file "junittester.xml".
<p>The next examples will demonstrate the XML importer with the JSP user interface. It uses 3 XML files with XML Importer commands. In order to understand these, you must have read the XML Importer documentation.
<ol>
<li>In a browser, go to <a href="http://localhost/mmapps/xmlimporter/jsp/importhome.jsp">http://localhost/mmapps/xmlimporter/jsp/importhome.jsp</a>.
<li>Use the "Browse..." buttons to select the files "transaction1.xml", "transaction2.xml" and "transaction3.xml" in the /demo directory of the unzipped file. These are the XML files to be processed by the XML importer.
<li>Press "Start Upload", this will upload the files to a webserver directory ("import" in your MMBase config directory).
<li>Press "Back to import page" to return to the importer homepage.
<li>Now you can select one of the uploaded files under "Start Import". Select "transaction1.xml" and press "Start Import" to process that file.
<li>Description of <b>transaction1.xml</b>:<br>
This transaction creates new objects: 1 movie and 3 related persons - of which 2 are identical.
These are then merged based on an exact match of persons and movies.
Note that:
<ul>
<li>When this transaction is repeated it will not create new objects, because the objects are already present in the persistent cloud.
<li>The two identical persons are merged and result in a single persons object.
</ul>
<li>The next html-pages will inform you when the XML importer has finished, also telling "NO DUPLICATES FOUND", meaning there were no problems (see below). Go to the MMBase editors for personsxxx and moviesxxx to see the resulting objects.
<li>From to the importer homepage import "transaction2.xml" in the same way.
<li>Desciption of <b>transactions2.xml: </b><br>
This transaction creates new objects:1 movie and 1 related person.
These are then merged based on an exact match of persons and movies.
Note that:
<ul>
<li>Since the persons merge is based on an exact match of fullnames, "Erik Visser" and "Eric Visser" are considered different persons.
<li>Since the movies merge is based on an exact match of titles, "Finalist the Movie" and "Finalist the Movie II" are considered different movies.
</ul>
<li>The next html-pages will inform you when the XML importer has finished, also telling "NO DUPLICATES FOUND", meaning there were no problems. Go to the MMBase editors for personsxxx and moviesxxx to see the resulting objects.
<li>Repeat the import of either transaction1.xml or transaction2.xml. This time, no objects will be created, since they are already present.
<li>From the importer homepage import "transaction3.xml" in the same way.
<li>Description of <b>transactions3.xml: </b><br>
This transaction creates new objects:1 movie and 1 related person.
These are then merged based on a fuzzy match of persons (90%) and movies (95%).
Note that:
<ul>
<li>Since the merge is based on a fuzzy (90%) match of fullnames, "Erik Visser", "Eric Visser" and "Erie Visser" are considered the same person, so there will be ambiguity when merging the persons.
<li>Since the movies merge is based on a fuzzy (95%) match of titles, "Finalist the Movie II" and "Finalist the Movie III" are considered the same movie, and "Finalist the Movie" is considerd a different movie, so there is no ambiguity when merging the movies.
</ul>
<li>The next html-pages will inform you when the XML importer has finished, but this time with the following message: "DUPLICATES FOUND". This means there was a transaction that could not be committed because an ambiguity arose while looking for similar objects.
<li>Take a look at the file "import\report\tcpReport.txt" in your MMBase config directory, to see which transaction was not committed and what the problem was. (You can set the name of the reportFile by setting the reportFile attribute of the transactions element.)
<li>Repeat the import of transactions3.xml, but this time be sure to check the "process duplicates interactive" checkbox.
<li>In the interactive mode, the XML importer will consult you as soon as it runs into ambiguity because of duplicates. It will show you the original (input) object, and the objects resulting from merging it with the different candidates. Choose the mergeresult with fullname "Erik Visser" by pressing the button beneath it.
<li>Go to the MMBase editors to see the resulting objects. In this case both the movie and person are merged with existing objects, but a new relation is added, since this relation was not present already.
<li>Finally, return to the importer homepage, and use third section to delete the uploaded files from the server.
</ol>

<h4>How to de-install the examples</h4>
Reverse the steps in the examples installation guide to de-install the examples.
