<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core" xmlns:deploy="deploy" xmlns:ant="jelly:ant">

  <!-- after the prepare-bin-filesystem also copy libs and config  -->
  <postGoal name="dist:prepare-bin-filesystem">
    <j:set var="copyextra.basedir" value="${maven.dist.bin.assembly.dir}"/>
    <attainGoal name="copyextra"/>

  </postGoal>

  <!-- after the prepare-src-filesystem also copy libs and config  -->
  <postGoal name="dist:prepare-src-filesystem">
    <j:set var="copyextra.basedir" value="${maven.dist.src.assembly.dir}"/>
    <attainGoal name="copyextra"/>
    <ant:available file="mmapps-base" type="dir" property="mmapps_base.present"/>
    <j:if test="${mmapps_base.present}">
      <ant:copy todir="${copyextra.basedir}/mmapps-base">
        <ant:fileset dir="mmapps-base">
          <ant:include name="**/*"/>
        </ant:fileset>
      </ant:copy>
    </j:if>
    <!-- dist plugin create broken build.xml -->
    <ant:delete file="${maven.dist.src.assembly.dir}/build.xml"/>
  </postGoal>

  <goal name="copyextra">
    <deploy:copy-deps todir="${copyextra.basedir}/lib" excludes="${dist.excludes}"/>
    <ant:available file="config" type="dir" property="config.present"/>
    <ant:available file="templates" type="dir" property="templates.present"/>
    <j:if test="${config.present}">
      <ant:copy todir="${copyextra.basedir}/config">
        <ant:fileset dir="config">
          <ant:include name="**/*"/>
        </ant:fileset>
      </ant:copy>
    </j:if>
    <j:if test="${templates.present}">
      <ant:copy todir="${copyextra.basedir}/templates">
        <ant:fileset dir="templates">
          <ant:include name="**/*"/>
        </ant:fileset>
      </ant:copy>
    </j:if>
  </goal>
</project>
