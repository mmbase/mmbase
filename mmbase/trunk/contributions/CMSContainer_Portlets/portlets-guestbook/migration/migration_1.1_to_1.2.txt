Migration document:

Intro:
The module portlets-guestbook includes an optional validaton using jcaptcha: http://jcaptcha.sourceforge.net/
See LCM-94.

Part: portlets-guestbook
From versie: 1.1
To versie: 1.2

Execute the following steps below in the given order:

Name: make jcaptcha work on unix
Goal: allow the AWT to run in a headless (without a display) environment, this is needed for jcaptcha.
Type: manual action

Stop tomcat
In the file $TOMCAT_HOME/bin/catalina.sh (on unix) add the folowing line at the begining of the file:
JAVA_OPTS="-Djava.awt.headless=true"  
Start tomcat

Name: enable validation for guestbook
Goal: enable validation for guestbook
Type: manual action  

In the CMS Admin area add the follwing system property:
name: "guestbook.usevalidation"
value: "true" (or "false" to disable it.) 
Publish the system properties to actualize them also on the live environment.
	
Name: configuration for using the guestbook validation
Goal: configuration for using the guestbook validation with jcaptcha
Type: manual action  

Add the following in the maven-base/project.xml

<dependency>
	<groupId>jcaptcha</groupId>
	<artifactId>jcaptcha-all</artifactId>			
	<type>jar</type>
	<version>1.0-RC3</version>
	<properties>
		<war.bundle>${war.bundle}</war.bundle>
	</properties>
</dependency>

Add the following in the web.xml files from both war-live and war-staging:

	<servlet>
        <servlet-name>jcaptcha</servlet-name>
        <servlet-class>com.finalist.captcha.CaptchaServlet</servlet-class>
        <load-on-startup>0</load-on-startup>
    </servlet>
	
	<servlet-mapping>
        <servlet-name>jcaptcha</servlet-name>
        <url-pattern>/jcaptcha</url-pattern>
    </servlet-mapping>
	



