<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" []>
<article id="frontenddevelopers-editwizard-index">
  <articleinfo>
    <title>MMBase Search &amp; Relate Tags</title>
    <date>2009-08-08</date>
    <edition>$Id: index.xml 35281 2009-05-18 18:45:35Z michiel $</edition>
    <authorgroup>
      <author>
        <firstname>Michiel</firstname>
        <surname>Meeuwissen</surname>
      </author>
    </authorgroup>
    <legalnotice>
      <para>This software is OSI Certified Open Source Software. OSI Certified is a certification mark of the Open Source Initiative.</para>
      <para>The license (Mozilla version 1.0) can be read at the MMBase site. See <ulink url="http://www.mmbase.org/license">http://www.mmbase.org/license</ulink></para>
    </legalnotice>
  </articleinfo>
  <section id="introduction">
    <title>Introduction</title>
    <para>The Search &amp; Relate tags are an addition to the MMBase taglib, and add more sophisticated functionality mainly target at interaction with users who want to create <emphasis>relations</emphasis> between MMBase nodes</para>

    <para>The creation of simple form based editors is quite simple</para>
    <programlisting format="linespecific"><![CDATA[
    <mm:form>
     <mm:node>
      <mm:field name="title">
         <mm:input />
      </mm:field>
      </mm:node>
      <mm:valid>
         <mm:commit />
      </mm:valid>
    ]]></programlisting>
    <para>So there is no need for some extra servlet receiving the post. The JSP itself can handle
    everthing.</para> <para>MMBase-taglib does not however provide a way to add simple 'relation'
    editors to this formalism. It can be made, but it is not simple, and needs a lot of customized
    code. This 'Search &amp; Relate Component fixes that.</para>
  </section>
  <section id="installation">
    <title>Installation</title> <para>Search &amp; Relate is distributed as a 'war
    overlay'. Installation only requires overlaying this war. The only prequisites is the 'base'
    mmbase war, i.e. mmbase and mmbase taglib, and the templates of /mmbase which belong to
    those.</para>
    <para>After Installation this documentation and examples can be found in the MMBase admin pages /mmbase/admin</para>
  </section>
  <section id="ajax">
    <title>AJAX &amp; JQuery</title>
    <para>In contradiction to the tags of the mmbase taglib, which are all completely self contained,
    most, if not all, the functionality of the tags of this application heavily depends on AJAX
    calls. This means that a bunch of server side JSP servlets and javascript libraries (based on
    JQuery and JQuery-UI) are needed. Those can be found in the /mmbase/searchrelate
    directory.</para>

  </section>
  <section id="relatednodes">
    <title>mm-sr:relatednodes</title>
    <para>
      The relatednodes tag is a bit like the mm:relatednodes tag, but it produces a list of to the
      current node related nodes which can be <emphasis>edited</emphasis>. It can work in 2 ways. It
      can work stand alone, and then it works completely 'transactionless'. Every change is
      submitted implicetely. If you use it inside an mm:form, it will also submit implicetly to the
      server, but <emphasis>to the transaction</emphasis>, which means that to actually store the
      information this form/transaction must be submitted with a mm:commit.
    </para>
    <para>
      The must basic use is exactly as a mm:relatednodes tag.
    </para>
    <programlisting format="linespecific"><![CDATA[
    <mm:node>
       <mm-sr:relatednodes role="posrel" type="news" orderby="posrel.pos" />
       ...
]]></programlisting>
    <para>
      There are however a few extra attributes, and a few which behave a bit differently. They can be found in the
      <ulink url="http://www.mmbase.org/tags/mm/searchrelate/">reference</ulink>.
    </para>
    <section id="items">
      <title>mm-sr:relatednodes items</title>
      <para>
        We must say a bit more about the 'item' attribute.  The item attribute is used if you want to customize one item in the list beyond the options provided by e.g. the 'fields', 'delete', and 'unlink' attributes.
        Noticeably, it can be used to make <emphasis>nested</emphasis> lists.
      </para>
      <para>
        The idea is that you point with this attribute to your own JSP which is to be used in stead of the default one in /mmbase/searchrelated/item.jspx.
      </para>
      <para>
        You can suppose a current node ("${_node}" in EL) in this JSP. The JSP will further receive
        parameters 'rid' and 'fieldlistid'. The 'rid' can be used to pick up all settings of the
        current mm-sr:relatednodes which you might need from the session. This goes easiest by including this:
      </para>
      <programlisting format="linespecific"><![CDATA[
      <jsp:directive.include file="/mmbase/searchrelate/list/parameters.jspf" />

      Now I can use ${parameters.source}, ${parameters.search} etc.
     <mm:import externid="fieldlistid" />

     <mm:fieldlist id="${fieldlistid}"
      ...
]]></programlisting>
      <para>
        The fieldlistid can help you to produce unique name's on the input widgets , which is important if the form gets complicated.
      </para>
      <note>
        <title>Backwards compatibility</title>
        <para>Previously these item jsps, received other parameters, like 'source', 'fields',
        'confirm' and 'icondir'. This is currently dropped, because they were getting more and more,
        and it was decided to summarize everything in 'rid'. This is backwards incompatible, we may
        add some of these parameters again, to fix that.
        </para>
      </note>
    </section>
    <section id="transactionless">
      <title>Transactionless editing</title>
      <para>
      </para>
    </section>
    <section id="delete">
      <title>mm-sr:delete</title>
      <para>
      </para>
    </section>
    <section id="transaction">
      <title>Using a transaction (mm:form)</title>
      <para>
      </para>
    </section>
    <section id="listjs">
      <title>List</title>
      <para>The javascript associated with mm-sr:relatednodes can be found in /mmbase/searchrelate/List.js.jsp, and the jsps associated with that, are found
      in /mmbase/searchrelate/list/.
      </para>
    </section>
  </section>
  <section id="search">
    <title>mm-sr:search</title>
    <para>mm-sr:search is actually just a simplified version of mm-sr:relate (it only shows the 'search' part).
    </para>
  </section>
  <section id="relate">
    <title>mm-sr:relate</title>
    <para>Current and Repository Queries</para>
    <section id="searcherjs">
      <title>Javascript</title>
      <para>The javascript associated with mm-sr:relate can be found in /mmbase/searchrelate/Searcher.js.jsp, and the jsps associated with that, are found
      in /mmbase/searchrelate/.
      </para>
      <section id="searcherjs1">
        <title>MMBaseSearcher</title>
        <para>
        </para>
      </section>
      <section id="searcherjs2">
        <title>MMBaseRelater</title>
        <para>
        </para>
      </section>
    </section>
  </section>
  <section id="tabs">
    <title>mm-sr:tabs</title>
    <para>
    </para>
  </section>
</article>

