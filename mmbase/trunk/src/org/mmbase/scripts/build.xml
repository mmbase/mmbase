<!-- ===========================================================================

MMBase Build File. See <http://jakarta.apache.org/> for more information
about the Ant build tool.

============================================================================ -->

<project name="MMBase" default="compile" basedir=".">

  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
  <target name="init">
    <property name="name"    value="mmbase"/>

    <property name="build.compiler" value="classic"/>
    <property name="debug"          value="on"/>
    <property name="optimize"       value="on"/>
    <property name="deprecation"    value="off"/>

    <property name="src.dir"     value="../../.."/>
    <property name="packages"    value="org.mmbase.*"/>

    <property name="build.dir"     value="../../../../build"/>
    <property name="build.dest"     value="${build.dir}/classes"/>
    <property name="build.javadocs" value="${build.dir}/javadocs"/>

    <available property="tomcat.present" 
               classname="org/apache/tomcat/startup" />
  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="usage">
    <echo message=""/>
    <echo message="MMBase Build file"/>
    <echo message="*************************************************************"/>
    <echo message=""/>
    <echo message=" available targets are:"/>
    <echo message=""/>
    <echo message="   jar   --> generates the mmbase.jar file"/>
    <echo message="   compile   --> compiles the source code (default)"/>
    <echo message="   javadocs  --> generates the API documentation"/>
    <echo message="   clean     --> cleans up the directory after building"/>
    <echo message=""/>
    <echo message="*************************************************************"/>
    <echo message=""/>
  </target>

  <!-- =================================================================== -->
  <!-- Prepares the build directory                                        -->
  <!-- =================================================================== -->
  <target name="prepare" depends="init">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.dest}"/>
  </target>

  <!-- =================================================================== -->
  <!-- Compiles the source directory                                       -->
  <!-- =================================================================== -->
  <target name="compile" depends="prepare">

    <copydir src="${src.dir}" dest="${build.dest}">
      <include name="**/scripts/**" />
      <include name="**/platform/**" />
      <include name="**/docs/**" />
      <include name="**/*.properties" />
      <include name="**/*.xml" />
      <include name="**/*.dtd" />
      <include name="**/*.sh" />
      <include name="**/LICENSE" />
    </copydir>

    <javac srcdir="${src.dir}"
           destdir="${build.dest}"
           debug="${debug}"
           optimize="${optimize}"
           deprecation="${deprecation}">
      <exclude name="**/JumpersInterceptor.java" unless="tomcat.present" />
      <exclude name="**/hitlisted/**" />
      <exclude name="**/scripts/**" />
      <exclude name="**/docs/**" />
      <exclude name="**/log/**" />
      <exclude name="**/*.properties" />
      <exclude name="**/*.xml" />
      <exclude name="**/*.dtd" />
      <exclude name="**/*.sh" />
      <exclude name="**/LICENSE" />
    </javac>
  </target>

  <!-- =================================================================== -->
  <!-- Creates the jar file                                                -->
  <!-- =================================================================== -->
  <target name="jar" depends="compile">
    <jar jarfile="${build.dir}/${name}.jar"
         basedir="${build.dest}"
         includes="org/**"/>
  </target>

  <!-- =================================================================== -->
  <!-- Creates the API documentation                                       -->
  <!-- =================================================================== -->
  <target name="javadocs" depends="prepare">
    <mkdir dir="${build.javadocs}"/>
    <javadoc packagenames="${packages}"
             sourcepath="${src.dir}"
             destdir="${build.javadocs}"
             author="true"
             version="true"
             use="false"
             noindex="true"
             windowtitle="MMBase API"
             doctitle="MMBase"
             bottom="Moet nog een tekstje voor bedacht worden."
    />
  </target>

  <!-- =================================================================== -->
  <!-- Clean target                                                        -->
  <!-- =================================================================== -->
  <target name="clean" depends="init">
    <deltree dir="${build.dir}"/>
  </target>

</project>
