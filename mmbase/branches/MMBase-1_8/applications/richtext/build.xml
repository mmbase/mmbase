<?xml version="1.0"?>
<project name="richtext" default="kupu" basedir=".">
  <property name="java.source.version" value="1.5" />

  <property name="kupu.repository" value="http://codespeak.net/svn/kupu/trunk/kupu" />
  <property name="kupu.revision"   value="-r 59953" />

  <import file="../buildbase-include.xml" />


  <target name="clean" depends="buildbase.clean">
    <mkdir dir="mmbase/kupu" />
    <exec executable="make" dir="mmbase/kupu">
      <arg line="clean" />
    </exec>
    <!-- I HATE ANT , I just don't want errors if the directory happens to be non existings -->
    <mkdir dir="mmbase/kupu/mmbase" />
    <exec executable="make" dir="mmbase/kupu/mmbase">
      <arg line="clean" />
    </exec>
  </target>

  <target name="template.include">
    <zipfileset dir="${project.source.dir}" prefix="${zip.name}/web-app">
      <patternset id="web-app.package.files" >
        <include name="mmbase/style/**" />
        <include name="mmbase/kupu/mmbase/**/*.jspx" />
        <include name="mmbase/kupu/mmbase/**/*.css" />
        <include name="mmbase/kupu/mmbase/**/*.js" />
        <include name="mmbase/kupu/mmbase/icons/**" />
        <include name="mmbase/kupu/common/**" />
        <include name="templates/**" />
      </patternset>
    </zipfileset>
  </target>

  <target name="install.config" depends="init" if="config.available">
    <copy todir="${mmbase.config}" preservelastmodified="true">
      <fileset dir="${project.config.dir}" >
        <include name="applications/**" />
        <exclude name="**/INDEX" />
      </fileset>
    </copy>
  </target>



  <target name="kupu">
    <!--
    <svn javahl="false">
      <checkout url="http://codespeak.net/svn/kupu/trunk/kupu/" />
    </svn>

result:kupu:
      [svn] Using javasvn
Svn : Checking out a working copy from a repository :
checkout -r HEAD http://codespeak.net/svn/kupu/trunk/kupu/
HTTP 301 MOVED PERMANENTLY: http://codespeak.net/svn/kupu/trunk/kupu

Beats me: it's impossible.

To hell with it.
This is a _whole lot_ easier.
    -->
    <mkdir dir="mmbase/kupu" />
    <exec executable="svn" dir="mmbase">
      <arg line="co ${kupu.revision}  ${kupu.repository}" />
    </exec>
    <exec executable="make" dir="mmbase/kupu">
      <arg line="kupu-i18n.jar" />
    </exec>
    <exec executable="make" dir="mmbase/kupu/mmbase" />
    <exec executable="make" dir="mmbase/kupu/mmbase">
      <arg line="mmbase-kupu-i18n.jar" />
    </exec>
    <copy todir="${project.build.dir}" preservelastmodified="true" flatten="true">
      <fileset dir="mmbase/kupu">
        <include name="**/*.jar" />
      </fileset>
    </copy>
  </target>
</project>
