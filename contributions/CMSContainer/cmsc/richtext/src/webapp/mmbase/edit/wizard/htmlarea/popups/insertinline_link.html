<html>

<head>
  <title>Insert/Modify Link</title>
  <script type="text/javascript" src="popup.js"></script>
  <script type="text/javascript">
    window.resizeTo(400, 200);

I18N = window.opener.HTMLArea.I18N.dialogs;
is_ie = window.opener.HTMLArea.is_ie;

function i18n(str) {
  return (I18N[str] || str);
};

function onTargetChanged() {
  var f = document.getElementById("f_other_target");
  if (this.value == "_other") {
    f.style.visibility = "visible";
    f.select();
    f.focus();
  } else f.style.visibility = "hidden";
};

function Init() {
  __dlg_translate(I18N);
  __dlg_init();
  var param = window.dialogArguments;
  var target_select = document.getElementById("f_target");
  if (param) {
      document.getElementById("f_href").value = param["f_href"];
      document.getElementById("f_title").value = param["f_title"];
      document.getElementById("f_destination").value = param["f_destination"];
      comboSelectValue(target_select, param["f_target"]);
      if (target_select.value != param.f_target) {
        var opt = document.createElement("option");
        opt.value = param.f_target;
        opt.innerHTML = opt.value;
        target_select.appendChild(opt);
        opt.selected = true;
      }
  }
  var opt = document.createElement("option");
  opt.value = "_other";
  opt.innerHTML = i18n("Other");
  target_select.appendChild(opt);
  target_select.onchange = onTargetChanged;
  document.getElementById("f_href").focus();
  document.getElementById("f_href").select();
};

function onOK() {
  var elhref = document.getElementById("f_href");
  
  
  if (is_ie ? elhref.readOnly : elhref.hasAttribute("readonly")) {
    var el = document.getElementById("f_destination");
    if(!el.value) {
      var message = i18n("You must select an item");
      alert(message);
      return false;
    }
    else {
      var el = document.getElementById("f_title");
      if (!el.value) {
        var message = i18n("You must enter a title");
        alert(message);
        el.focus();
        return false;
      }
    }
  }
  else {
    if (!elhref.value) {
      var message = i18n("You must enter the URL where this link points to");
      alert(message);
      elhref.focus();
      return false;
    }
    else {
      var re = new RegExp("\://|javascript\:");
      if (!elhref.value.match(re)) {
        var message = i18n("Url is missing protocol (eg http://)");
        alert(message);
        elhref.focus();
        return false;
      }
    }
  }

  // pass data back to the calling window
  var fields = ["f_href", "f_title", "f_target", "f_destination" ];
  var param = new Object();
  for (var i in fields) {
    var id = fields[i];
    var el = document.getElementById(id);
    param[id] = el.value;
  }
  if (param.f_target == "_other")
    param.f_target = document.getElementById("f_other_target").value;
  __dlg_close(param);
  return false;
};

function onCancel() {
  __dlg_close(null);
  return false;
};

function onElement() {
  openPopupWindow('../../../../../editors/repository/select/index.jsp','filterwindow2',800,650);
  return false;
};

function onAttachment() {
  openPopupWindow('../../../../../editors/resources/AttachmentInitAction.do','filterwindow2',800,650);
  return false;
};

function onUrl() {
  openPopupWindow('../../../../../editors/resources/UrlInitAction.do','filterwindow2',800,650);
  return false;
};

function onNewUrl() {
  var elhref = document.getElementById("f_href");
  if (is_ie) {
    elhref.readOnly = false;
  }
  else {
    elhref.removeAttribute("readonly");
  }
  elhref.value = '';
  elhref.focus();
  document.getElementById("f_destination").value = '';
  return false;
};

function selectElement(element_id, title, url) {
   document.getElementById("f_destination").value = element_id;
   var elhref = document.getElementById("f_href");
   
   if (is_ie) {
     elhref.readOnly = true;
   }
   else {
      elhref.setAttribute("readonly", "true");
   }
  
   if (url != undefined && url.length != 0 ) {
      document.getElementById("f_href").value = url;
   }
   if (document.getElementById("f_title").value == undefined 
         || document.getElementById("f_title").value.length == 0 ) {
      document.getElementById("f_title").value = title;
   }
}

function openPopupWindow(url, windowName, width, height) {
   debug = false;
   if (!width) {w = 750;} else { w = width; }
   if (!height) {h = 750;} else { h = height; }
   var left = (screen.availWidth - w)/2;
   var top = (screen.availHeight - h)/2;
   if (screen.availWidth < w) {
      w = screen.availWidth;
      left = 0;
   }
   if (screen.availHeight < h) {
      h = screen.availHeight - 25;
      top = 0;
   }
   if (debug) {
      alert("width: " + w + " " + left);
      alert("height: " + h + " " + top);
   }
   str = 'window.open(url,"' + windowName + '","width=' + w + ',height=' + h + ',left=' + left + ',top=' + top + ',scrollbars=yes,status=no,toolbar=no,menubar=no,location=no,resizable=yes")';

   if (debug) {
      alert(str);
   }

   obj = eval(str);
   if (document.all) {
      // set a opener for ie because its a dialog and not a popup (unlike mozilla) 
      obj.opener = this;
   }

   return true;
}
</script>

<style type="text/css">
html, body {
  background: ButtonFace;
  color: ButtonText;
  font: 11px Tahoma,Verdana,sans-serif;
  margin: 0px;
  padding: 0px;
}
body { padding: 5px; }
table {
  font: 11px Tahoma,Verdana,sans-serif;
}
select, input, button { font: 11px Tahoma,Verdana,sans-serif; }
button { width: 70px; }
table .label { text-align: right; width: 8em; }

.title { background: #ddf; color: #000; font-weight: bold; font-size: 120%; padding: 3px 10px; margin-bottom: 10px;
border-bottom: 1px solid black; letter-spacing: 2px;
}

#buttons {
      margin-top: 1em; border-top: 1px solid #999;
      padding: 2px; text-align: right;
}
</style>

</head>

<body onload="Init()">
<div class="title">Insert/Modify Link</div>

<form name="inlineLinkForm" action="" method="get">
  <input type="hidden" name="destination" id="f_destination" />

<table border="0" style="width: 100%;">
  <tr>
    <td class="label">URL:</td>
    <td><input type="text" id="f_href" style="width: 100%" readonly /></td>
  </tr>
  <tr>
    <td class="label">Title (tooltip):</td>
    <td><input type="text" id="f_title" style="width: 100%" /></td>
  </tr>
  <tr>
    <td class="label">Target:</td>
    <td><select id="f_target">
      <option value="">None (use implicit)</option>
      <option value="_blank">New window (_blank)</option>
      <option value="_self">Same frame (_self)</option>
      <option value="_top">Top frame (_top)</option>
    </select>
    <input type="text" name="f_other_target" id="f_other_target" size="10" style="visibility: hidden" />
    </td>
  </tr>
</table>
      <button name="attachment" onclick="return onAttachment();" title="Search for an attachment">Attachment</button>
      <button name="element" onclick="return onElement();" title="Search for an element">Element</button>
      <button name="urlelement" onclick="return onUrl();" title="Search for an url">Url</button>
      <button name="newurlelement" onclick="return onNewUrl();" title="Enter new url">New Url</button>
<div id="buttons">
  <button type="button" name="ok" onclick="return onOK();">OK</button>
  <button type="button" name="cancel" onclick="return onCancel();">Cancel</button>
</div>

</form>

</body>
</html>
