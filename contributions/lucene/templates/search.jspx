<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:mm="http://www.mmbase.org/mmbase-taglib-2.0">
  <jsp:output doctype-root-element="html"
              doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN" doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"/>
  <jsp:directive.include file="head.jspx" />
  <body class="basic">
    <!-- This is a completely generic tool to search in a lucene index -->
    <mm:content type="text/html">
      <mm:cloud>
        <mm:import externid="max">100</mm:import>          
        <mm:import externid="offset">0</mm:import>
        <mm:import externid="sortfields" />
        <mm:import externid="value" />
        <mm:import externid="extraconstraints" />
        <mm:import externid="count" />
        <mm:import externid="index" />
        <mm:import externid="reindex" />
        <mm:url id="back" write="false" page="/mmbase/style/images/back.png" />

        <h1>Searching ${index}</h1>
        <p>
          current time in seconds since 1970: <jsp:expression>System.currentTimeMillis() / 1000</jsp:expression>
        </p>
        <p>
          <mm:link page="."><a href="${_}" class="navigate"><img src="${back}" alt="back" /></a></mm:link>
        </p>
        
        <form action="search.jspx" method="post">
          <mm:write referid="value" escape="text/html/attribute">
            <input name="value" value="${_}" />
          </mm:write>
          <mm:write referid="index" escape="text/html/attribute">
            <input type="hidden" name="index" value="${_}" />
          </mm:write>
          <input type="submit" />
          <br />
          <mm:write referid="extraconstraints" escape="text/html/attribute">
            <jsp:text>contraints: </jsp:text><input name="extraconstraints" value="${_}" />
          </mm:write>
          <jsp:text>max: </jsp:text><input name="max" value="${max}" />
          <jsp:text>offset: </jsp:text><input name="offset" value="${offset}" />
          <mm:write referid="sortfields" escape="text/html/attribute">
            <jsp:text>sort: </jsp:text><input name="sortfields" value="${_}" />
          </mm:write>
          <jsp:text>count: </jsp:text>
          <mm:compare referid="count" value="on">
            <input type="checkbox" name="count" checked="checked" />
          </mm:compare>
          <mm:compare referid="count" value="on" inverse="true">
            <input type="checkbox" name="count" />
          </mm:compare>
          
        </form>
        
        <mm:present referid="value" >
          <table>
            <mm:nodelistfunction module="lucene" name="search" referids="value,index,max,offset,extraconstraints,sortfields">
              <mm:first>
                <tr>
                  <th>type</th>
                  <mm:fieldlist type="list">
                    <th><mm:fieldinfo type="name" /></th>
                  </mm:fieldlist>
                  <th>
                    Search on '${value}'<br /> 
                    <mm:size /> hits
                    <mm:compare referid="count" value="on">
                      of total <mm:function module="lucene" name="searchsize" referids="value,index,extraconstraints" />
                    </mm:compare>
                  </th>
                </tr>
              </mm:first>
              <tr>
                <td>
                  <mm:nodeinfo type="guinodemanager" />
                </td>
                <mm:fieldlist type="list">
                  <td>
                    <mm:hasfunction name="gui">
                      <mm:fieldinfo type="guivalue" />
                    </mm:hasfunction>
                    <mm:hasfunction name="gui" inverse="true">
                      <mm:fieldinfo type="value" />
                    </mm:hasfunction>
                  </td>
                </mm:fieldlist>
                <td>
                  <mm:hasfunction name="url">
                    <mm:function name="url" escape="text/html/attribute">                    
                      link:
                      <a href="${_}">
                        <mm:hasfunction name="gui">
                          <mm:function name="gui">
                            <mm:isempty>
                              here
                            </mm:isempty>
                            <mm:write escape="none" />
                          </mm:function>
                        </mm:hasfunction>
                        <mm:hasfunction name="gui" inverse="true">
                          ${_}
                        </mm:hasfunction>
                      </a>
                    </mm:function>
                  </mm:hasfunction>
                  <mm:hasfunction name="url" inverse="true">
                    <mm:hasfunction name="gui">
                      <mm:function name="gui" escape="none" />
                    </mm:hasfunction>
                  </mm:hasfunction>
                </td>
              </tr>
            </mm:nodelistfunction>
          </table>
        </mm:present>
        
      </mm:cloud>
    </mm:content>
  </body>
</html>
