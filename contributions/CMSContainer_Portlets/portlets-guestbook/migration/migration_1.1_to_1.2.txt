Migration document:

Intro:
The module portlets-guestbook includes an optional validaton using simplecaptcha: http://simplecaptcha.sourceforge.net/
See LCM-94.

Part: portlets-guestbook
From versie: 1.1
To versie: 1.2

Execute the following steps below in the given order:

Name: make simplecaptcha work on unix
Goal: allow the AWT to run in a headless (without a display) environment, this is needed for simplecaptcha.
Type: manual action

Stop tomcat
In the file $TOMCAT_HOME/bin/catalina.sh (on unix) add the folowing line at the begining of the file:
JAVA_OPTS="-Djava.awt.headless=true"  
Start tomcat

Name: enable validation for guestbook
Goal: enable validation for guestbook
Type: manual action  

In the CMS Admin area add the follwing system property:
name: "guestbook.usevalidation"
value: "true" (or "false" to disable it.) 
Publish the system properties to actualize them also on the live environment.
	
Name: configuration for using the guestbook validation
Goal: configuration for using the guestbook validation with simplecaptcha
Type: manual action  

Add the following in the maven-base/project.xml

<dependency>
	<groupId>simplecaptcha</groupId>
	<artifactId>simplecaptcha</artifactId>			
	<type>jar</type>
	<version>20070403</version>
	<properties>
		<war.bundle>${war.bundle}</war.bundle>
	</properties>
</dependency>

Add the following in the web.xml files from both war-live and war-staging:

	<servlet>
		<servlet-name>Captcha</servlet-name>
		<display-name>Captcha</display-name>
		<servlet-class>nl.captcha.servlet.CaptchaServlet</servlet-class>
		<init-param>
			<param-name>cap.char.arr</param-name>
			<param-value>0,1,2,3,4,5,6,7,8,9</param-value>
		</init-param>
		<init-param>
			<param-name>cap.char.arr.l</param-name>
			<param-value>6</param-value>
		</init-param>
	</servlet>
	
	<servlet-mapping>
		<servlet-name>Captcha</servlet-name>
		<url-pattern>/Captcha.jpg</url-pattern>
	</servlet-mapping>
	
Exceptions/errors/other problems and what to do:

For more information about configuration in web.xml check http://simplecaptcha.sourceforge.net/

If a different version of simplecaptcha.jar needs to be used, and if problems appear on unix with the new version, check the
article http://javaboutique.internet.com/tutorials/captcha/index-2.html.
