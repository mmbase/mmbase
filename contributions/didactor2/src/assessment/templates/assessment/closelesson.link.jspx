<div
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:mm="http://www.mmbase.org/mmbase-taglib-2.0"
    xmlns:di="http://www.didactor.nl/ditaglib_1.0"
    xmlns:mm-sr="http://www.mmbase.org/tags/mm/searchrelate"
    class="submitItems">
  <jsp:output omit-xml-declaration="true" />

  <mm:import id="currentlesson" from="session" externid="currentlesson_${user}_${education}" />
	  <c:if test="${! empty currentlesson}">
    <mm:node referid="currentlesson" id="currentlesson" />
    <mm:node number="$user">
      <mm:function name="canCloseLesson"
                   referids="currentlesson@lesson" write="false">
        <c:choose>
          <c:when test="${_}">
            <mm:treefile page="/assessment/closelesson.jsp"
                         objectlist="$includePath"
                         write="false"
                         >
							<c:set var="formAction" value="${_}" />
            </mm:treefile>
          </c:when>
          <c:otherwise>
            <mm:import id="feedback"><di:translate key="assessment.waitforfeedback" /></mm:import>
          </c:otherwise>
        </c:choose>
      </mm:function>
    </mm:node>
  </c:if>
  
  <form name="closelessonform" action="${formAction}"   method="post">
   	<input type="button" class="educationButton" value="opslaan" onclick="window.location.reload()"/><jsp:text>&amp;nbsp;|&amp;nbsp;</jsp:text>
		<input type="hidden" name="coachmode" value="false"  />
    <input type="hidden" name="lesson" value="${currentlesson}"  />
    <c:if test="${empty feedback and ! empty currentlesson}">
    	<di:translate key="assessment.close_and_send_to_coach" arg0="${currentlesson.name}">
    		<mm:import externid="justclosed">false</mm:import>
    		<c:if test="${justclosed}">
    			<input type="button" class="educationButton" value="je les is verstuurd" /><jsp:text> | </jsp:text>
    		</c:if>
      	<c:if test="${!justclosed}">
      		<input type="submit" class="educationButton" value="${_}" /><jsp:text> | </jsp:text>
      	</c:if>
      	
			</di:translate>				 
		</c:if>
		<c:if test="${!empty feedback}">
			${feedback}<jsp:text> | </jsp:text>
		</c:if>
				<mm:link page="/education/">
				<c:set var="target" value="lessen" />
 			 	<c:if test="${!empty currentlesson}">
 			 		<mm:node number="${currentlesson}">
 			 		<c:set var="learnobject" value="${currentlesson}" />
 			 		<c:set var="target" value="opdrachten" />
 			 			<!-- TODO: find a nicer/proper way to do this -->
 			 			<mm:relatednodes type="xmlcontent" constraints="lower(name) = 'opdrachten'">
 			 					<mm:node>
 			 						<c:set var="learnobject" value="${_node}" />
 			 					</mm:node>
 			 			</mm:relatednodes>
 			 		</mm:node>
 			 		<mm:param name="learnobject">${learnobject}</mm:param>
 			 	</c:if>
 			   <input type="button" class="educationButton" value="terug naar de ${target}" onclick="window.location='${_}'" name="" />
 			 </mm:link>
                   
  </form>            
</div>
