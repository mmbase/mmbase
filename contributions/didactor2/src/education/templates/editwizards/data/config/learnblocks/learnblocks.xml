<?xml version="1.0"?>
<!DOCTYPE wizard-schema PUBLIC "-//MMBase/DTD editwizard 1.0//EN" "http://www.mmbase.org/dtd/wizard-schema_1_0.dtd"
[
   <!ENTITY extra_loads SYSTEM "extra_loads.xml">
   <!ENTITY extra_steps SYSTEM "extra_steps.xml">
   <!ENTITY extra_schemas SYSTEM "extra_schemas.xml">
   <!ENTITY extra_lists SYSTEM "extra_listS.xml">
]>
<wizard-schema id="empty">
    <title>Leerblok Editor</title>

    <action type="create">
       <object type="learnblocks">
           <field name="showtitle">1</field>
       </object>
    </action>

    <action type="load">
        <relation destination="learnobjects" role="posrel" />
        <relation destination="mmevents" role="related" />
        <relation destination="images" role="sizerel" />
       <relation destination="paragraphs" role="posrel">
           <object>
              <relation destination="attachments" role="posrel" />
              <relation destination="images" role="pos2rel" />
              <relation destination="urls" role="posrel" />
           </object>
        </relation>
        <relation destination="audiotapes" role="posrel" />
        <relation destination="videotapes" role="posrel" />
        <relation destination="attachments" role="posrel" />
        <relation destination="urls" role="posrel" />
        &extra_loads;
    </action>

    <action type="delete" />

    <lists>
       <optionlist include="config/option_list/images_position.xml" />
       <optionlist include="config/option_list/boolean.xml" />
       <optionlist include="config/option_list/layout.xml" />
       <optionlist include="config/option_list/imagelayout.xml" />
   </lists>


    <steps>
        <step form-schema="step1" />
        <step form-schema="step2" />
        <step form-schema="step3" />
        &extra_steps;
    </steps>

    <form-schema id="step1">
        <title>Leerblok invoeren</title>
        <field name="name" >
            <prompt>Naam</prompt>
        </field>

      <field name="showtitle" ftype="enum">
         <prompt xml:lang="nl">Titel laten zien</prompt>
         <prompt xml:lang="en">Show title</prompt>
         <optionlist select="boolean" />
      </field>


        <field name="intro" ftype="${wizards.pages.text.ftype}" dtminlength="0">
            <prompt>Tekst</prompt>
        </field>

        <field name="layout" ftype="enum">
            <prompt>Layout</prompt>
            <optionlist select="layout" />
        </field>
         <field name="imagelayout" ftype="enum">
            <prompt>Layout afbeeldingen</prompt>
            <optionlist select="imagelayout" />
        </field>

       <list role="sizerel" extends="config/image/sizedimages.xml" />
        <list role="posrel" extends="config/attachment/attachments-posrel.xml" />
        <list role="posrel" extends="config/audiotape/audiotapes-posrel.xml" />
        <list role="posrel" extends="config/videotape/videotapes-posrel.xml" />

        <list destination="urls" role="posrel" extends="config/url/urls-posrel.xml" />


        <!--
           We want to list learnobjects, but there are objects that extend learnobject that we want to show.
           if you do the following:
             <list destination="learnobjects" role="posrel">
           then you can't show the 'tests' or 'pages' items, since the editwizard engine will simply discard
           them since they don't have the 'learnobject' type; it generates:
             <list destination="learnobjects" fdatapath="relation[@role='posrel' and object/@type='learnobjects']" ...

           Note: the 'wizard.xsl' file depends on the title being "Bijbehorende leerobjecten" in order to
           select the correct JSP for finding learnobjects. DO NOT CHANGE THIS TITLE!
        -->
        <list minoccurs="0" maxoccurs="*" ordertype="number" orderby="field[@name='pos']"
            fdatapath="relation[@role='posrel' and ( object/@type='learnblocks' or object/@type='flashpages' or object/@type='tests' or object/@type='pages' )]" searchdir="destination">
            <title>Bijbehorende leerobjecten</title>
            <item>
                <field name="name" ftype="data">
                    <prompt>Naam</prompt>
                    <description>Naam van het leerobject</description>
                </field>
                <field fdatapath="field[@name=&apos;pos&apos;]" ftype="line"><prompt>Positie</prompt></field>
            </item>

            <action type="create">
                <relation role="posrel" destinationtype="learnobjects">
                  <field name="pos">{sum(//relation[@role='posrel' and @lastitem='true']/field[@name='pos'])+{$pos}}</field>
                </relation>
            </action>

            <command name="startwizard" inline="true" wizardname="config/learnblocks/learnblocks" objectnumber="new">
              <prompt xml:lang="en">New learnblock</prompt>
              <prompt xml:lang="nl">Nieuw leerblok</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="config/pages/pages" objectnumber="new">
              <prompt xml:lang="en">New page</prompt>
              <prompt xml:lang="nl">Nieuwe pagina</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="config/flashpages/flashpages" objectnumber="new">
              <prompt xml:lang="en">New flash page</prompt>
              <prompt xml:lang="nl">Nieuwe flash pagina</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="config/tests/tests" objectnumber="new">
              <prompt xml:lang="en">New test</prompt>
              <prompt xml:lang="nl">Nieuwe toets</prompt>
            </command>

            <command name="startwizard" inline="true" wizardname="config/htmlpages/htmlpages" objectnumber="new">
              <prompt xml:lang="en">New htmlpage</prompt>
              <prompt xml:lang="nl">Nieuwe htmlpagina</prompt>
            </command>
            <command name="search" nodepath="learnobjects" fields="name" age="-1" orderby="number" directions="down" >
                <prompt>Zoeken naar leerobjecten</prompt>
                <search-filter>
                    <name>Naam bevat</name>
                    <search-fields>name</search-fields>
                </search-filter>
           </command>
        </list>

        <!-- we need a new list because there can be only one search command per list -->
        <list minoccurs="0" maxoccurs="*" ordertype="number" orderby="field[@name='pos']"
            fdatapath="relation[@role='posrel' and ( object/@type='learnblocks' or object/@type='flashpages' or object/@type='tests' or object/@type='pages' )]" searchdir="destination">
            <title>Zoeken op metadata</title>
            <item displaytype="none"></item>

            <action type="create">
                <relation role="posrel" destinationtype="learnobjects">
                  <field name="pos">{sum(//relation[@role='posrel' and @lastitem='true']/field[@name='pos'])+{$pos}}</field>
                </relation>
            </action>
             <command name="search" nodepath="metadata,learnobjects" fields="learnobjects.name,metadata.value" age="-1" orderby="learnobjects.number" directions="down" >

                <prompt>Zoeken naar leerobjecten op metadata</prompt>
                <search-filter>
                    <name>Metadata</name>
                    <search-fields>metadata.value</search-fields>
                </search-filter>
           </command>
        </list>

        <list role="related" extends="config/online/online-list.xml" />

        &extra_lists;
    </form-schema>

    <form-schema id="step2">
        <title>Alineas invoeren</title>
        <field name="name" ftype="data"/>
        <field name="showtitle" ftype="enum">
           <prompt xml:lang="nl">Titel laten zien</prompt>
           <prompt xml:lang="en">Show title</prompt>
           <optionlist select="boolean" />
        </field>
        <list extends="config/paragraphs/add_paragraphs_posrel.xml"/>
    </form-schema>

    &extra_schemas;
</wizard-schema>
