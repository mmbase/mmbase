<project name="install-dependency">
  <!-- =================================================================== -->
  <!-- Various targets for automated installation of maven artifacts      -->
  <!-- =================================================================== -->

  <property name="download.dir"           location="download" />
  <property name="version"                value="1.9.0-SNAPSHOT" />
  <property name="prefix"                 value="mmbase-" />
  <property name="mmbase.templates.path"  value="mmbase/" />
  <property name="base"                   value="mmbase" />
  <property name="local.repository"       value="${user.home}/.maven/repository" />
  <property name="remote.repository"      value="http://www.mmbase.org/maven" />
  <property name="remote.repository2"     value="http://repo1.maven.org/maven/" />


  <target name="unzipdownloadzip" if="download.zip.present"
          unless="download.dir.present">
    <unzip src="${download.zip}" dest="${download.dir}" overwrite="false" />
  </target>

  <target name="download.init.get" depends="proxyflags">

    <available property="download.zip.present" file="${download.zip}" />
    <available property="download.dir.present" file="${download.dir}" />

    <antcall target="unzipdownloadzip" />
    <echo message="Making ${download.dir}" />
    <!-- Init actions -->
    <mkdir dir="${download.dir}"/>
    <mkdir dir="${expand.dir}"/>
  </target>

  <target name="proxyflags" >
    <!-- check proxy parameters. -->
    <condition property="useproxy">
      <equals arg1="${proxy.use}" arg2="on" />
    </condition>
  </target>

  <target name="setproxy"  if="useproxy">
    <taskdef name="setproxy"
      classname="org.apache.tools.ant.taskdefs.optional.net.SetProxy" />
    <setproxy proxyhost="${proxy.host}" proxyport="${proxy.port}"/>
    <echo message="Using ${proxy.host}:${proxy.port} to download ${sourcefile}"/>
  </target>


  <target name="testexpanded">
    <echo message="Testing for ${expandedfile}"/>
    <available file="${expandedfile}" property="expanded"/>
  </target>

  <target name="get"  depends="setproxy">
    <mkdir dir="${download.dir}" />
    <copy file="${local.repository}/${file}" tofile="${download.dir}/${destfile}" preservelastmodified="true" overwrite="false" failonerror="false" />
    <get src="${remote.repository}/${file}" dest="${download.dir}/${destfile}"  usetimestamp="true"  ignoreerrors="true" />
    <get src="${remote.repository2}/${file}" dest="${download.dir}/${destfile}"  usetimestamp="true"  ignoreerrors="true" />
  </target>


  <target name="get.war">
    <antcall target="get">
      <param name="file"  value="mmbase/wars/${name}-${version}.war" />
      <param name="destfile"  value="${name}-${version}.war" />
    </antcall>
  </target>

  <target name="install.war">
    <antcall target="get.war" />
    <unzip src="${download.dir}/${name}-${version}.war" dest="${dest}" />
  </target>

  <target name="get.module">
    <antcall target="get">
      <param name="file" value="mmbase/mmbase-modules/${prefix}${name}-${version}.mmbase-module" />
      <param name="destfile" value="${prefix}${name}-${version}.mmbase-module" />
    </antcall>
  </target>

  <target name="install.module" depends="get.module">
    <echo message="${prefix}${name}-${version}" />
    <unzip src="${download.dir}/${prefix}${name}-${version}.mmbase-module" dest="${dest}/mmbase/components/${name}">
      <patternset>
        <include name="blocks/**"/>
      </patternset>
      <mapper type="glob" from="blocks/*" to="*" />
    </unzip>
    <unzip src="${download.dir}/${prefix}${name}-${version}.mmbase-module" dest="${dest}">
      <patternset>
        <include name="templates/**"/>
      </patternset>
      <mapper type="glob" from="templates/*" to="${mmbase.templates.path}*" />
    </unzip>
    <unzip src="${download.dir}/${prefix}${name}-${version}.mmbase-module" dest="${dest}/WEB-INF/">
      <patternset>
        <include name="config/**"/>
      </patternset>
      <mapper type="glob" from="config/*" to="config/*" />
    </unzip>
    <unzip src="${download.dir}/${prefix}${name}-${version}.mmbase-module" dest="${dest}/WEB-INF/lib">
      <patternset>
        <include name="lib/**"/>
      </patternset>
      <mapper type="glob" from="lib/*" to="*" />
    </unzip>
    <unzip src="${download.dir}/${prefix}${name}-${version}.mmbase-module" dest="${dest}">
      <patternset>
        <include name="examples/**"/>
      </patternset>
      <mapper type="glob" from="examples/*" to="mmexamples/${name}/*" />
    </unzip>
  </target>

  <target name="mmbase" depends="log4j,commons-fileupload">
    <antcall target="install.module">
      <param name="name" value="" />
      <param name="prefix" value="mmbase" />
      <param name="mmbase.templates.path" value="" />
    </antcall>
  </target>

  <target name="mmbase.jar">
    <antcall target="install.jar">
      <param name="name" value="mmbase" />
    </antcall>
  </target>

  <target name="editwizard" depends="dove,mmbase">
    <antcall target="install.module">
      <param name="name" value="editwizard" />
      <param name="mmbase.templates.path" value="mmbase/edit/wizard/" />
    </antcall>
  </target>

  <target name="dove" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="dove" />
    </antcall>
  </target>

  <target name="taglib" depends="mmbase,jstl">
    <antcall target="install.module">
      <param name="name" value="taglib" />
    </antcall>
  </target>

  <target name="crontab" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="crontab" />
    </antcall>
  </target>

  <target name="email" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="email" />
    </antcall>
  </target>

  <target name="clustering" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="clustering" />
    </antcall>
  </target>

  <target name="resources" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="resources" />
    </antcall>
  </target>

  <target name="jumpers" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="jumpers" />
    </antcall>
  </target>

  <target name="richtext" depends="mmbase">
    <antcall target="install.module">
      <param name="name" value="richtext" />
    </antcall>
  </target>


  <target name="searchrelate" depends="mmbase,jstl">
    <antcall target="install.module">
      <param name="name" value="searchrelate" />
    </antcall>
  </target>

  <target name="rmmci-client">
    <antcall target="install.jar">
      <param name="name" value="mmbase-rmmci-client" />
    </antcall>
  </target>


  <target name="install.jar">
    <antcall target="get">
      <param name="file" value="${base}/jars/${name}-${version}.jar" />
      <param name="destfile" value="${name}-${version}.jar" />
    </antcall>
    <copy file="${download.dir}/${name}-${version}.jar" todir="${jardest}" preservelastmodified="true" overwrite="false" failonerror="false" />
  </target>

  <target name="log4j">
    <antcall target="install.jar">
      <param name="name" value="log4j" />
      <param name="base" value="log4j" />
      <param name="version" value="1.2.13" />
    </antcall>
  </target>

  <target name="junit">
    <antcall target="install.jar">
      <param name="name" value="junit" />
      <param name="base" value="junit" />
      <param name="version" value="3.8.2" />
    </antcall>
  </target>

  <target name="jstl">
    <antcall target="install.jar">
      <param name="name" value="jstl" />
      <param name="base" value="jstl" />
      <param name="version" value="1.1.2" />
    </antcall>
  </target>


  <target name="hsqldb">
    <antcall target="install.jar">
      <param name="name" value="hsqldb" />
      <param name="base" value="hsqldb" />
      <param name="version" value="1.8.0.7" />
    </antcall>
  </target>

  <target name="servletapi">
    <antcall target="install.jar">
      <param name="name" value="servletapi" />
      <param name="base" value="servletapi" />
      <param name="version" value="2.4" />
    </antcall>
  </target>



  <target name="commons-fileupload">
    <antcall target="install.jar">
      <param name="name" value="commons-fileupload" />
      <param name="base" value="commons-fileupload" />
      <param name="version" value="1.0" />
    </antcall>
  </target>
  <target name="oscache">
    <antcall target="install.jar">
      <param name="name" value="oscache" />
      <param name="base" value="opensymphony" />
      <param name="version" value="2.4.1" />
    </antcall>
  </target>

  <target name="minimalistic" depends="mmbase,taglib,oscache" />


</project>
