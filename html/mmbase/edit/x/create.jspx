<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:mm="http://www.mmbase.org/mmbase-taglib-2.0">

  <!-- 
       Offers a form for one new MMBase node.
       Also handles the form, and then redirects to change.jspx, because the node is existng then.
       $Id: create.jspx,v 1.9 2006-04-27 09:56:23 michiel Exp $
  -->

  <jsp:directive.page session="true" buffer="200kb" />
  <mm:include page="head.jspx" />
  <body>
    <mm:content type="application/xhtml+xml" language="client" expires="0" postprocessor="none">
      <mm:cloud rank="basic user">
        <mm:import externid="nodemanager" required="true" />        

        <mm:import externid="submitted">init</mm:import>

        <h1 class="${submitted}">
          <mm:link page="." referids="nodemanager">
            <a href="${_}" class="back"><span class="navigate">back</span></a>
          </mm:link>
            <a href="javascript:document.getElementById('createform').submit();" class="ok"><span class="navigate">ok</span></a>
          <jsp:text>New</jsp:text>
        </h1>
        <mm:form id="createform">
          <input type="hidden" name="nodemager" value="${nodemanager}" />
          <input type="hidden" name="submitted" value="submitted" />
          <table>
            <mm:fieldlist type="edit" nodetype="$nodemanager">
              <mm:index id="index" write="false" />
              <tr class="${index % 2 == 0 ? 'even' : 'odd'}">
                <td><mm:fieldinfo type="guiname" /></td>
                <td>
                  <mm:fieldinfo type="input" />
                  <mm:fieldinfo type="errors" />
                </td>
              </tr>
            </mm:fieldlist>
          </table>
          <input type="submit" name="ok" />

          <mm:compare referid="submitted" value="submitted">
            <!-- handle the form -->
            <mm:valid>
              <mm:createnode id="newnode" type="${nodemanager}">
                <mm:fieldlist type="edit">
                  <mm:fieldinfo type="useinput" />
                </mm:fieldlist>
              </mm:createnode>
              <mm:commit />
              <mm:redirect page="change.jspx" referids="newnode@node,nodemanager">
                <mm:param name="ok" value="ok" />
              </mm:redirect>
            </mm:valid>
          </mm:compare>
        </mm:form>
      </mm:cloud>
    </mm:content>
  </body>
</html>
