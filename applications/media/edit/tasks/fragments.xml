<?xml version="1.0"?>
<!DOCTYPE wizard-schema PUBLIC "-//MMBase/DTD editwizard 1.0//EN" "http://www.mmbase.org/dtd/wizard-schema_1_0.dtd"
 [
    <!ENTITY formats SYSTEM "formats.xml">
  ]
>
<wizard-schema id="media">
	<title>Media editor</title>

	<action type="create">
		<object type="mediafragments">
			<field name="title">Don't forget to add a title</field>
		</object>
	</action>
	
	<action type="delete" />
	
	<action type="load">
		<relation destination="mediasources" role="posrel" />
		<relation destination="mediafragments" role="parent" />
	</action>

  &formats;

	<form-schema id="basics">
		<title>MediaEditor</title>
		<field name="title" >
			<prompt>Title</prompt>
		</field>

		<field name="subtitle" >
			<prompt>Subtitle</prompt>
		</field>

		<field name="intro" ftype="text" rows="4" >
			<prompt>Intro</prompt>
		</field>
		
		<field name="body" ftype="text" rows="8" >
			<prompt>Body</prompt>
		</field>

		<list role="posrel" destination="mediasources" minoccurs="0" maxoccurs="*"  orderby="field[@name='pos']" >
      <title>Sources</title>       
      <item>
        <field name="url">
          <prompt>Url (relative)</prompt>
        </field>
        <field ftype="enum" name="format">
          <prompt>Format</prompt>
          <optionlist select="formats" />
        </field>
      </item>
			<action type="create">
				<relation  role="posrel">
             <object type="mediasources" />
          <field name="pos">{sum(//relation[@role='posrel' and @lastitem='true']/field[@name='pos'])+{$pos}}</field>
        </relation>
			</action>
		</list>
  </form-schema>

  <form-schema id="itemize">
    <title>Itemize</title>
		<list role="parent" destination="mediafragments" minoccurs="0" maxoccurs="*" orderby="field[@name='start']">
      <title>Items</title>       
      <item>          
        <field name="title">
           <prompt>
             item
           </prompt>
        </field>
        <field name="start"  ftype="realposition">
          <prompt>
            start
          </prompt>
        </field>
        <field name="stop" ftype="realposition">
          <prompt>
            stop
          </prompt>
        </field>
      </item>
		
			<action type="create">
				<relation  role="parent"  destinationtype="mediafragments">
          <object type="mediafragments" />
        </relation>
			</action>
		</list>

	</form-schema>

</wizard-schema>
