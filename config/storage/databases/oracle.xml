<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE storage PUBLIC "-//MMBase//DTD storage config 1.0//EN" "http://www.mmbase.org/dtd/storage_1_0.dtd" >
<storage>
  <storagemanagerfactory classname="org.mmbase.storage.implementation.database.DatabaseStorageManagerFactory" version="0.1" />
  <storagemanager classname="org.mmbase.storage.implementation.database.ViewDatabaseStorageManager" version="0.1" />
  <searchqueryhandler classname="org.mmbase.storage.search.implementation.database.BasicSqlHandler" />

  <attributes>
    <!-- No file path, then use webdir -->
    <attribute name="database-binary-file-path"></attribute>

    <attribute name="storage-identifier-case">upper</attribute>

    <attribute name="max-identifier-length">30</attribute>

    <!-- Oracle is a hell when is comes to blobs, so store as file instead of in the database-->
    <option name="database-stores-binary-as-file" />

    <!-- When transactions are enabled, strange things happen -->
    <option name="database-supports-transactions" value="false" />

    <option name="database-supports-insert-triggers" value="true" />
    <option name="database-supports-delete-triggers" value="true" />
    <option name="database-supports-update-triggers" value="true" />

    <scheme name="create-table-scheme">CREATE TABLE {1} ({2} {3} {5})</scheme>
    <scheme name="create-object-table-scheme">CREATE TABLE {1} ({2} {3} {5})</scheme>
    <scheme name="create-foreign-key-scheme">CONSTRAINT {5} FOREIGN KEY ({2}) REFERENCES {3} ({4})</scheme>

    <scheme name="create-sequence-scheme" />
    <scheme name="init-sequence-scheme" >CREATE SEQUENCE {0}_AUTOINCREMENT MINVALUE 1 START WITH {2} INCREMENT BY {3}</scheme>
    <scheme name="update-sequence-scheme" />
    <scheme name="read-sequence-scheme">SELECT {0}_AUTOINCREMENT.NEXTVAL FROM DUAL</scheme>

    <scheme name="create-index-scheme">CREATE INDEX {3} ON {1} ({2})</scheme>
    <scheme name="delete-index-scheme">DROP INDEX {3}</scheme>

    <scheme name="create-view-scheme">CREATE OR REPLACE VIEW {1} ({3}) AS SELECT {4} FROM {2}, {6} WHERE {2}.{5} = {6}.{5}</scheme>

    <scheme name="create-insert-trigger-scheme">
      CREATE OR REPLACE TRIGGER {8}
      INSTEAD OF INSERT ON {1}
      FOR EACH ROW
      BEGIN
        INSERT INTO {2} ({4}) VALUES ({5});
        INSERT INTO {3} ({6}) VALUES ({7});
      END {8};
    </scheme>
    <scheme name="create-delete-trigger-scheme">
      CREATE OR REPLACE TRIGGER {5}
      INSTEAD OF DELETE ON {1}
      FOR EACH ROW
      BEGIN
        DELETE FROM {2} WHERE {4} = :OLD.{4};
        DELETE FROM {3} WHERE {4} = :OLD.{4};
      END {5};
    </scheme>
    <scheme name="create-update-trigger-scheme">
      CREATE OR REPLACE TRIGGER {7}
      INSTEAD OF UPDATE ON {1}
      FOR EACH ROW
      BEGIN
        UPDATE {2} SET {4} WHERE {6} = :OLD.{6};
        UPDATE {3} SET {5} WHERE {6} = :OLD.{6};
      END {7};
    </scheme>

  </attributes>

  <!-- Oracle type mappings -->
  <type-mappings>
    <type-mapping name="FLOAT" type="REAL" />
    <type-mapping name="DOUBLE" type="DOUBLE PRECISION" />
    <type-mapping name="LONG" type="INTEGER" />
    <type-mapping name="INTEGER" type="INTEGER" />
    <type-mapping name="NODE" type="INTEGER" />
    <type-mapping name="STRING" min-size="1" max-size="2000" type="nvarchar2({0,number,#####})" />
    <type-mapping name="STRING" min-size="2000" max-size="16777216" type="nclob" />
    <type-mapping name="XML" min-size="1" max-size="2000" type="nvarchar2({0,number,#####})" />
    <type-mapping name="XML" min-size="2000" max-size="16777216" type="nclob" />
    <type-mapping name="BINARY" min-size="1" max-size="16777216" type="blob" />

    <type-mapping name="DATETIME" type="TIMESTAMP" />
    <type-mapping name="BOOLEAN" type="BOOLEAN" />
    <type-mapping name="LIST[FLOAT]"   type="FLOAT[]" />
    <type-mapping name="LIST[DOUBLE]"  type="DOUBLE PRECISION[]" />
    <type-mapping name="LIST[LONG]"    type="BIGINT[]" />
    <type-mapping name="LIST[INTEGER]" type="INTEGER[]" />
    <type-mapping name="LIST[NODE]"    type="INTEGER[]" />
    <type-mapping name="LIST[STRING]"  type="CLOB[]" />
    <type-mapping name="LIST[XML]"     type="CLOB[]" />
    <type-mapping name="LIST[DATETIME]"  type="TIMESTAMP[]" />
    <type-mapping name="LIST[BOOLEAN]"   type="BOOLEAN[]" />
  </type-mappings>

  <!-- Oracle disallowed fields are retrieved from the database -->
  <disallowed-fields>
    <disallowed-field name="size" replacement="m_size"/>
    <disallowed-field name="number" replacement="m_number"/>
    <disallowed-field name="column" replacement="m_column"/> <!-- standard SQL keyword -->
    <disallowed-field name="comment" replacement="m_comment"/>
    <disallowed-field name="create" replacement="m_create"/> <!-- standard SQL keyword -->
    <disallowed-field name="data" replacement="m_data"/>
    <disallowed-field name="day" replacement="m_day"/> <!-- standard SQL keyword -->
    <disallowed-field name="delayed" replacement="m_delayed"/>
    <disallowed-field name="fields" replacement="m_fields"/>
    <disallowed-field name="from" replacement="m_from"/> <!-- standard SQL keyword -->
    <disallowed-field name="global" replacement="m_global"/> <!-- standard SQL keyword -->
    <disallowed-field name="group" replacement="m_group"/> <!-- standard SQL keyword -->
    <disallowed-field name="hosts" replacement="m_hosts"/>
    <disallowed-field name="hour" replacement="m_hour"/> <!-- standard SQL keyword -->
    <disallowed-field name="int" replacement="m_int"/> <!-- standard SQL keyword -->
    <disallowed-field name="key" replacement="m_key"/> <!-- standard SQL keyword -->
    <disallowed-field name="keys" replacement="m_keys"/>
    <disallowed-field name="local" replacement="m_local"/> <!-- standard SQL keyword -->
    <disallowed-field name="month" replacement="m_month"/> <!-- standard SQL keyword -->
    <disallowed-field name="order" replacement="m_order"/> <!-- standard SQL keyword -->
    <disallowed-field name="parent" replacement="m_parent"/>
    <disallowed-field name="read" replacement="m_read"/> <!-- standard SQL keyword -->
    <disallowed-field name="references" replacement="m_references"/> <!-- standard SQL keyword -->
    <disallowed-field name="second" replacement="m_second"/> <!-- standard SQL keyword -->
    <disallowed-field name="status" replacement="m_status"/>
    <disallowed-field name="time" replacement="m_time"/> <!-- standard SQL keyword -->
    <disallowed-field name="to" replacement="m_to"/> <!-- standard SQL keyword -->
    <disallowed-field name="type" replacement="m_type"/>
    <disallowed-field name="use" replacement="m_use"/>
    <disallowed-field name="write" replacement="m_write"/> <!-- standard SQL keyword -->
    <disallowed-field name="start" replacement="m_start"/> <!-- standard SQL keyword -->
    <disallowed-field name="mode" replacement="m_mode"/> <!-- standard SQL keyword -->
    <disallowed-field name="session" replacement="m_session"/> <!-- standard SQL keyword -->
    <disallowed-field name="level" replacement="m_level"/> <!-- standard SQL keyword -->
  </disallowed-fields>
</storage>
